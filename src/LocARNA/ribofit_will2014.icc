/* RIBOFIT */
#include <array>

const std::array<char, 4>
Ribofit_will2014::will2014_nucleotides = {'A','C','G','U'};

const double
Ribofit_will2014::will2014_bmscore_coefficients[11][3] = {
    { -4.73282057930961, 1.32532878814051, 0 }, /* A~A */
    { -4.57521652488738, 0, 0.982599252910067 }, /* C~A */
    { -5.97217428408409, 1.82454306509937, 0 }, /* C~C */
    { -4.32245107184253, 0, 0.971752260414008 }, /* G~A */
    { -4.1765173723806, 0, 0.925731389528251 }, /* G~C */
    { -3.48222939518777, 1.18080625434216, 0 }, /* G~G */
    { -4.78024261107626, 0, 1.05335448302883 }, /* U~A */
    { -2.03750342979811, 0, 0.521244462650731 }, /* U~C */
    { -4.01327148310311, 0, 0.916810727817665 }, /* U~G */
    { -7.35439775672202, 2.01981375526511, 0 }, /* U~U */
    {}
};

const double
Ribofit_will2014::will2014_amscore_coefficients[137][3] = {
    { -86.2483166176055, 21.1973229234007, 0 }, /* AA~AA */
    { -85.298072524832, 17.928437560008, 2.65665434897459 }, /* AC~AA */
    { -4.4102253891401, 2.71430832813475, 0 }, /* AC~AC */
    { -84.3749842266136, 18.1334261541115, 2.38541139295881 }, /* AG~AA */
    { -29.5806941500672, 6.37099688111335, 0.342148951695616 }, /* AG~AC */
    { -25.3277999099641, 7.39801932820689, 0 }, /* AG~AG */
    { -28.2049541575049, 5.30268221987702, 1.50205418300319 }, /* AU~AA */
    { -6.8348902562068, 1.1513243103799, 0.77755207260912 }, /* AU~AC */
    { -6.95515501911991, 0.697245156853223, 0.852109187367793 }, /* AU~AG */
    { -9.49945136249984, 2.64690684579255, 0 }, /* AU~AU */
    { -65.3186554542072, 13.6893330657523, 2.15186694659376 }, /* CA~AA */
    { -61.5076593352746, 12.8105680881112, 1.59018493010916 }, /* CA~AC */
    { -47.2980105222129, 9.94334623708279, 1.25988185397615 }, /* CA~AG */
    { -30.4244822665848, 5.34072712597408, 1.70825874108706 }, /* CA~AU */
    { -50.0771830811251, 12.9647396981027, 0 }, /* CA~CA */
    { -43.8245793369318, 8.52414624107556, 1.61623952355931 }, /* CC~AA */
    { -35.6303530233229, 7.95223606198017, 0.853226979873788 }, /* CC~AC */
    { -26.9326197885708, 5.52452600756142, 0.0356579665574503 }, /* CC~AG */
    { -5.83524596476941, 0, 1.58258245176206 }, /* CC~AU */
    { -63.4780976827568, 13.4975703770366, 1.50684853042373 }, /* CC~CA */
    { -80.488232434109, 19.9592481843355, 0 }, /* CC~CC */
    { -18.8796898090167, 2.92776499875879, 1.43785290265834 }, /* CG~AA */
    { -14.5530917019124, 1.90397851047267, 1.20028004489343 }, /* CG~AC */
    { -3.68356224227692, 0, 0.860486166775427 }, /* CG~AG */
    { -4.86925249535254, 0.14883586693903, 0.8394188566763 }, /* CG~AU */
    { -20.0942307535376, 3.96121382522342, 0.889187529257465 }, /* CG~CA */
    { -14.4868216303012, 2.70978189893953, 0.418302832069453 }, /* CG~CC */
    { 0.16649812509965, 0.328740447245334, 0 }, /* CG~CG */
    { -70.7709298361945, 13.9535940568521, 2.67920766980924 }, /* CU~AA */
    { -65.414274208008, 12.6470901123823, 3.25135122662948 }, /* CU~AC */
    { -49.5973420903693, 9.69062958345749, 2.60828302865026 }, /* CU~AG */
    { -9.36034832830764, 1.1886686983756, 0.873423090862666 }, /* CU~AU */
    { -105.768750549119, 22.2841046512812, 3.18308517507019 }, /* CU~CA */
    { -109.666096428947, 23.0073901208729, 4.55922703334148 }, /* CU~CC */
    { -3.43207883212195, 0, 0.459559765379461 }, /* CU~CG */
    { -39.8208295422062, 10.7674229649751, 0 }, /* CU~CU */
    { -78.3171425715258, 16.2768232913284, 3.14414662031299 }, /* GA~AA */
    { -14.4654993021671, 3.06738900699944, 0.0427420604910047 }, /* GA~AC */
    { -45.7171703371414, 10.0740221952671, 0.905044506122121 }, /* GA~AG */
    { -7.02882628791255, 0, 1.6728625459523 }, /* GA~AU */
    { -28.5728970931956, 6.01658191347227, 1.31622295448297 }, /* GA~CA */
    { -48.9456816506413, 8.73984239981796, 2.97293357543213 }, /* GA~CC */
    { -31.7647658777085, 5.27798977491733, 2.13093031936502 }, /* GA~CG */
    { -67.9555490542808, 12.7571324038198, 3.86399437174719 }, /* GA~CU */
    { -19.2442680745711, 6.0164563036035, 0 }, /* GA~GA */
    { -24.4604881262428, 4.32809916911652, 1.15323877475488 }, /* GC~AA */
    { -1.49897632624477, 0, 0.200053318526639 }, /* GC~AC */
    { -22.9289957978067, 3.47101643022566, 1.87889292694393 }, /* GC~AG */
    { -2.67924671729783, 0, 0.668272039295622 }, /* GC~AU */
    { -19.2040014012528, 2.98126847508331, 1.16758959906974 }, /* GC~CA */
    { -22.4792588310255, 4.29263591200643, 1.20536139004855 }, /* GC~CC */
    { -5.09178934172567, 0, 1.0000217137193 }, /* GC~CG */
    { -8.06512170947912, 0, 1.78727774320855 }, /* GC~CU */
    { -5.61286393383148, 0, 1.50724629302859 }, /* GC~GA */
    { 0.410743145219779, 0.26618676053998, 0 }, /* GC~GC */
    { -49.3614153842709, 10.0132738107444, 1.98501600600853 }, /* GG~AA */
    { -15.2671624967474, 2.88431408217974, 0.484316564573547 }, /* GG~AC */
    { 2.46347794171345, 0, 0.61744068625268 }, /* GG~AG */
    { -23.8426202825164, 3.84408796272944, 1.81471688106614 }, /* GG~AU */
    { -63.8929838015963, 12.5419371217911, 2.89797344903699 }, /* GG~CA */
    { -39.6488195302476, 7.2631332907435, 2.02651030992918 }, /* GG~CC */
    { -3.06279172320693, 0, 0.443671382123535 }, /* GG~CG */
    { -6.40013198481928, 0, 1.28097516909111 }, /* GG~CU */
    { -40.9130359660181, 8.81449677900402, 1.79079547976113 }, /* GG~GA */
    { -18.780993995676, 3.19990998347016, 1.26647713311628 }, /* GG~GC */
    { -5.86417851701883, 3.01986581674134, 0 }, /* GG~GG */
    { -57.705846898154, 11.3124102199746, 2.42183834583485 }, /* GU~AA */
    { -23.0362658438689, 4.39550546485419, 1.19076256194972 }, /* GU~AC */
    { -29.1013043798907, 5.06157361510756, 1.74177190736488 }, /* GU~AG */
    { -10.7168212425901, 1.75615786016368, 0.800592328358314 }, /* GU~AU */
    { -25.0147569639213, 4.31737156411419, 1.28283532732544 }, /* GU~CA */
    { -36.4677010493406, 6.55852399543021, 2.07267777142991 }, /* GU~CC */
    { -4.81959810484808, 0, 0.796440618231984 }, /* GU~CG */
    { -4.3560236273403, 0, 1.22549917533945 }, /* GU~CU */
    { -13.2708009442014, 1.96475733639338, 1.0284326468117 }, /* GU~GA */
    { -2.57315409653995, 0, 0.593562319727144 }, /* GU~GC */
    { -2.98340280363263, 0, 0.642097036906517 }, /* GU~GG */
    { -4.87207430679381, 1.82709030938862, 0 }, /* GU~GU */
    { -4.53157746577648, 0.277299794254756, 0.995729599491985 }, /* UA~AA */
    { -39.4412939182227, 7.28379222500095, 1.9015751953602 }, /* UA~AC */
    { -7.04311260722761, 0, 1.83933920867672 }, /* UA~AG */
    { -5.73118749344709, 0.378808113849186, 0.952162484179011 }, /* UA~AU */
    { -8.09214619647829, 1.47901516931916, 0.691761093754679 }, /* UA~CA */
    { -27.8122678502423, 4.73764965231805, 1.68908552342992 }, /* UA~CC */
    { -2.76566685788652, 0, 0.692813655065128 }, /* UA~CG */
    { -10.0054055297844, 0.946648709661754, 1.37575451138637 }, /* UA~CU */
    { -5.55361410697579, 0, 1.33190438990753 }, /* UA~GA */
    { -6.64945409219394, 0.319822805726013, 1.04816950974846 }, /* UA~GC */
    { -9.89219136985444, 0.981312985310124, 1.09640335318463 }, /* UA~GG */
    { -5.33423162951729, 0, 1.03563289097709 }, /* UA~GU */
    { -6.86249442030683, 2.02455229518991, 0 }, /* UA~UA */
    { -109.508982826516, 22.2572568795731, 4.07300754245696 }, /* UC~AA */
    { -41.3939056322049, 9.66579732714133, 0.164246724708653 }, /* UC~AC */
    { -36.1869022933254, 8.02581439347392, 0.558061452863032 }, /* UC~AG */
    { -38.0616910107251, 7.30020641761606, 1.78268016780269 }, /* UC~AU */
    { -75.7334649732689, 16.1455471788743, 2.06360742562517 }, /* UC~CA */
    { -81.0979745878675, 17.6546639840913, 2.33018725839474 }, /* UC~CC */
    { -10.8883067804259, 1.49372945009429, 0.779522486141879 }, /* UC~CG */
    { -111.897616927684, 24.4014072767814, 3.42051047209588 }, /* UC~CU */
    { -77.1662787535554, 15.2333935384078, 3.91889364023515 }, /* UC~GA */
    { -14.0780892340152, 2.64353731344087, 0.561446379302177 }, /* UC~GC */
    { -26.5058655302828, 5.13100488953377, 1.02557934464791 }, /* UC~GG */
    { -0.739387823857864, 0, 0.152438968282974 }, /* UC~GU */
    { -17.7815020371159, 3.45572623827083, 0.980021091685316 }, /* UC~UA */
    { -78.0757702626625, 19.2133906842474, 0 }, /* UC~UC */
    { -4.06763511097119, 0, 0.962278783714011 }, /* UG~AA */
    { -5.28378549092793, 0, 1.07673439449532 }, /* UG~AC */
    { -2.93450234774723, 0.0609446860418262, 0.546726918697353 }, /* UG~AG */
    { -14.9546391915008, 2.12203118024768, 1.17994001125614 }, /* UG~AU */
    { -46.9805153563925, 9.51270273299971, 1.61575900148119 }, /* UG~CA */
    { -34.2090536943969, 6.10756780653776, 1.72411009837896 }, /* UG~CC */
    { -4.54662482173421, 0.560143825332155, 0.454079646165414 }, /* UG~CG */
    { -23.1098679174222, 3.70606101312923, 1.44094023385502 }, /* UG~CU */
    { -15.1069584507079, 1.92184777080413, 1.31798297268397 }, /* UG~GA */
    { -9.52099370677917, 0.939389505007162, 0.940011197039808 }, /* UG~GC */
    { -14.2824047799938, 2.66312299315361, 0.724850758360837 }, /* UG~GG */
    { -4.36642168085003, 0, 0.692052070786321 }, /* UG~GU */
    { -10.1502809958262, 1.66818450672412, 0.728452132599077 }, /* UG~UA */
    { -3.84717760434536, 0, 1.27452548145057 }, /* UG~UC */
    { -4.09534276381912, 1.62209001569755, 0 }, /* UG~UG */
    { -94.6460683623522, 19.3453146222441, 3.3930507220424 }, /* UU~AA */
    { -72.4063322858957, 15.3086559507566, 2.26004020587765 }, /* UU~AC */
    { -48.7675911943923, 9.93039795198016, 1.33489222709705 }, /* UU~AG */
    { -33.507661327917, 6.61434270993625, 1.33927188697027 }, /* UU~AU */
    { -52.6518518605837, 10.8735559828564, 1.86979019202318 }, /* UU~CA */
    { -126.043817740397, 26.8546456116024, 4.22658100531591 }, /* UU~CC */
    { -4.30438873075145, 0, 0.853574347549215 }, /* UU~CG */
    { -127.727657619493, 26.776975314812, 4.80663447260898 }, /* UU~CU */
    { -53.5134540607206, 10.0963510855966, 2.46247216968035 }, /* UU~GA */
    { -10.5319801147957, 1.21627356082438, 1.09556307466069 }, /* UU~GC */
    { -26.4295478306389, 4.73167413823179, 1.32858422086165 }, /* UU~GG */
    { -2.54086976885062, 0, 0.686918229560542 }, /* UU~GU */
    { -3.65838472955485, 0, 0.994705329040967 }, /* UU~UA */
    { -55.380251369989, 12.7172421347924, 0.966233981129526 }, /* UU~UC */
    { -3.38808258724508, 0, 0.989256944150036 }, /* UU~UG */
    { -29.1641615671389, 8.11870959395249, 0 }, /* UU~UU */
    {}
};

const double
Ribofit_will2014::will2014_bmscore(size_t i, size_t j, double identity) {
    if (i<j) {std::swap(i,j);}
    size_t idx=i*(i+1)/2+j;
    return will2014_bmscore_coefficients[idx][0]
        + will2014_bmscore_coefficients[idx][1]*log(identity)
        + will2014_bmscore_coefficients[idx][2]*log(100-identity);
}

const double
Ribofit_will2014::will2014_amscore(size_t i, size_t j,size_t k, size_t l, double identity) {
    size_t idx1=i*4+j;
    size_t idx2=k*4+l;
    if (idx1<idx2) {std::swap(idx1,idx2);}
    size_t idx=idx1*(idx1+1)/2+idx2;
    return will2014_amscore_coefficients[idx][0]
        + will2014_amscore_coefficients[idx][1]*log(identity)
        + will2014_amscore_coefficients[idx][2]*log(100-identity);
}
